{% load static %}
<!DOCTYPE html>
<html lang="zxx" class="no-js">

<head>
	<!-- Mobile Specific Meta -->
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Favicon-->
	<link rel="shortcut icon" href="{% static 'img/logo2.png' %}">
	<!-- Author Meta -->
	<meta name="author" content="CodePixar">
	<!-- Meta Description -->
	<meta name="description" content="">
	<!-- Meta Keyword -->
	<meta name="keywords" content="">
	<!-- meta character set -->
	<meta charset="UTF-8">
	<!-- Site Title -->
	<title>Baka Store</title>

	<!--
            CSS
            ============================================= -->
	<link rel="stylesheet" href="{% static 'css/linearicons.css' %}">
	<link rel="stylesheet" href="{% static 'css/owl.carousel.css' %}">
	<link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/themify-icons.css' %}">
	<link rel="stylesheet" href="{% static 'css/nice-select.css' %}">
	<link rel="stylesheet" href="{% static 'css/nouislider.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
	<link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
	<style>
        .single-product img {
            width: 100%;
            height: 350px; 
            object-fit: cover;
        }
		.about-us-widget {
			position: relative;
			z-index: 1;
			background: rgba(255, 255, 255, 0.108); 
			padding: 20px;
			border-radius: 10px;
		}
		
		.about-us-widget::before,
		.about-us-widget::after {
			content: '';
			position: absolute;
			z-index: -1;
			background-size: cover;
			background-position: center;
			width: 100px;
			height: 100px;
		}
		
		.about-us-widget::before {
			background-image: url('{% static "img/pngegg.png" %}'); 
			top: -20px;
			left: -20px;
		}
		
		.about-us-widget::after {
			background-image: url('{% static "img/naruto.png" %}'); 
			bottom: -20px;
			right: -20px;
		}
		
		.about-us-widget::before,
		.about-us-widget::after {
			opacity: 0.3; 
			transform: rotate(-15deg); 
			border-radius: 50%; 
		}

        .otaku-profile-area {
            background: #f9f9f9;
            padding: 2rem 0;
            font-family: 'Roboto', sans-serif;
        }
        
        .otaku-menu {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .otaku-menu .menu-header {
            margin-bottom: 2rem;
        }
        
        .otaku-menu .menu-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 1rem;
        }
        
        .otaku-menu h3 {
            color: #333;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .otaku-nav {
            list-style: none;
            padding: 0;
        }
        
        .otaku-nav li {
            margin-bottom: 1rem;
        }
        
        .otaku-nav li a {
            text-decoration: none;
            font-size: 1rem;
            color: #555;
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .otaku-nav li a .icon {
            margin-right: 0.5rem;
            font-size: 1.2rem;
        }
        
        .otaku-nav li.active a,
        .otaku-nav li a:hover {
            background: #ffdd57;
            color: #fff;
        }
        
        body {
            background-color: #f4f4f4;
            font-family: 'Roboto', sans-serif;
        }
        
        .user-profile-card {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .profile-header {
            background-color: #f8f9fa;
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }
        
        .avatar-container {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            cursor: pointer;
            overflow: hidden;
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .profile-avatar {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .avatar-container:hover .profile-avatar {
            transform: scale(1.1);
        }
        
        .avatar-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
            color: #fff;
        }
        
        .avatar-container:hover .avatar-overlay {
            opacity: 1;
        }
        
        .profile-header h2 {
            margin: 0;
            color: #333;
            font-size: 24px;
        }
        
        .profile-body {
            padding: 30px;
        }
        
        .user-info p {
            margin-bottom: 15px;
            color: #555;
            display: flex;
            align-items: center;
        }
        
        .user-info i {
            width: 20px;
            margin-right: 10px;
            color: #007bff;
        }
        
        .user-addresses h3 {
            margin-top: 30px;
            margin-bottom: 20px;
            font-size: 20px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .address-list {
            list-style-type: none;
            padding: 0;
        }
        
        .address-item {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: box-shadow 0.3s ease;
        }
        
        .address-item:hover {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .address-item span {
            color: #555;
        }
        
        .no-address {
            color: #6c757d;
            font-style: italic;
            text-align: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .btn {
            padding: 8px 15px;
            font-size: 14px;
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-add {
            background-color: #28a745;
            color: #ffffff;
            border: none;
        }
        
        .btn-add:hover {
            background-color: #218838;
        }
        
        .btn-edit {
            background-color: #ffc107;
            color: #212529;
            border: none;
        }
        
        .btn-edit:hover {
            background-color: #e0a800;
        }
        
        .profile-footer {
            padding: 20px 30px;
            background-color: #f8f9fa;
            border-top: 1px solid #e9ecef;
            text-align: right;
        }
        
        #editProfileBtn {
            background-color: #007bff;
            color: #ffffff;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
        }
        
        #editProfileBtn:hover {
            background-color: #0056b3;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .profile-header {
                padding: 20px;
            }
        
            .avatar-container {
                width: 120px;
                height: 120px;
            }
        
            .profile-header h2 {
                font-size: 20px;
            }
        
            .profile-body {
                padding: 20px;
            }
        
            .user-addresses h3 {
                font-size: 18px;
            }
        
            .address-item {
                flex-direction: column;
                align-items: flex-start;
            }
        
            .address-item button {
                margin-top: 10px;
            }
        }
    </style>
</head>

<body id="category">

	<!-- Start Header Area -->
	<header class="header_area sticky-header">
		<div class="main_menu">
			<nav class="navbar navbar-expand-lg navbar-light main_box">
				<div class="container">
					<!-- Brand and toggle get grouped for better mobile display -->
					<a class="navbar-brand logo_h d-flex align-items-center" href="{% url 'home' %}">
						<img src="{% static 'img/logo2.png' %}" alt="Baka Store Logo" style="height: 4rem; width: 4rem; margin-right: 0.5rem;">
						<p class="brand-text" style="font-size: 1.5rem; font-weight: bold; color: #333; margin: 0;">Baka Store</p>
					</a>
					
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
					 aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="collapse navbar-collapse offset" id="navbarSupportedContent">
						<ul class="nav navbar-nav menu_nav ml-auto">
							<li class="nav-item"><a class="nav-link" href="{% url 'home' %}">Home</a></li>
							<li class="nav-item submenu dropdown">
								<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
								 aria-expanded="false">Shop</a>
								<ul class="dropdown-menu">
									<li class="nav-item"><a class="nav-link" href="{% url 'category' %}">All Action Figures</a></li>
									<li class="nav-item"><a class="nav-link" href="#">New Arivals</a></li>
									<li class="nav-item"><a class="nav-link" href="#">Best Sellers</a></li>
									<li class="nav-item"><a class="nav-link" href="#">On Sale</a></li>
								</ul>
							</li>
							<li class="nav-item submenu dropdown">
								<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
								 aria-expanded="false">Character Types</a>
								<ul class="dropdown-menu">
									<li class="nav-item"><a class="nav-link" href="#">Heroes</a></li>
									<li class="nav-item"><a class="nav-link" href="#">Villains</a></li>
									<li class="nav-item"><a class="nav-link" href="#">Sidekicks</a></li>
									<li class="nav-item"><a class="nav-link" href="#">Monsters</a></li>
								</ul>
							</li>
							<li class="nav-item submenu dropdown active">
								<a href="#" class="nav-link dropdown-toggle " data-toggle="dropdown" role="button" aria-haspopup="true"
								 aria-expanded="false">Account</a>
								<ul class="dropdown-menu">
									{% if user.is_authenticated %}
            							<li class="nav-item">
                							<a class="nav-link" href="{% url 'user-logout' %}">Logout</a>
            							</li>
										<li class="nav-item">
                							<a class="nav-link" href="{% url 'wishlist' %}">Wishlist</a>
            							</li>
										<li class="nav-item">
                							<a class="nav-link" href="{% url 'account_details' %}">Account Settings</a>
            							</li>
       	 							{% else %}
            							<li class="nav-item">
                							<a class="nav-link" href="{% url 'user-login' %}">Login</a>
           	 							</li>
        							{% endif %}
								</ul>
							</li>
							<li class="nav-item"><a class="nav-link" href="#">Contact</a></li>
						</ul>
						<ul class="nav navbar-nav navbar-right">
							<li class="nav-item active"><a href="{% url 'cart' %}" class="cart"><span class="ti-bag"></span></a></li>
							<li class="nav-item">
								<button class="search"><span class="lnr lnr-magnifier" id="search"></span></button>
							</li>
						</ul>
					</div>
				</div>
			</nav>
		</div>
		<div class="search_input" id="search_input_box">
			<div class="container">
				<form class="d-flex justify-content-between">
					<input type="text" class="form-control" id="search_input" placeholder="Search Here">
					<button type="submit" class="btn"></button>
					<span class="lnr lnr-cross" id="close_search" title="Close Search"></span>
				</form>
			</div>
		</div>
	</header>
	<!-- End Header Area -->

	<!-- Start Banner Area -->
	<section class="banner-area organic-breadcrumb">
        <div class="container">
            <div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
                <div class="col-first">
                    <h1>Account Details</h1>
                    <nav class="d-flex align-items-center">
                        <a href="{% url 'home' %}">Home<span class="lnr lnr-arrow-right"></span></a>
                        <a href="{% url 'account_details' %}">Account</a>
                    </nav>
                </div>
            </div>
        </div>
    </section>
	<!-- End Banner Area -->
	<section class="otaku-profile-area">
        <div class="container">
            <div class="row">
                <!-- Anime-inspired Sidebar -->
                <div class="col-lg-3">
                    <div class="otaku-menu">
                        <div class="menu-header">
                            <img src="{% static 'img/logo2.png' %}" alt="Baka Store Logo" class="menu-logo">
                            <h3>Otaku Command Center</h3>
                        </div>
                        <ul class="otaku-nav">
                            <li class="active"><a href="{% url 'account_details' %}"><span class="icon">&#x1F464;</span> My Profile</a></li>
                            <li><a href="{% url 'order_history' %}"><span class="icon">&#x1F4C5;</span> Order History</a></li>
                            <li><a href="{% url 'wishlist' %}"><span class="icon">&#x2764;&#xFE0F;</span> Wishlist</a></li>
                            <li><a href="{% url 'wallet' %}"><span class="icon">&#x1F4B0;</span> Wallet</a></li>
                            <li><a href="{% url 'user-logout' %}"><span class="icon">&#x1F6AA;</span> Logout</a></li>
                        </ul>
                    </div>
                </div>
                <!-- Main Content Area -->
                <div class="col-lg-9">
                    <div class="user-profile-card">
                        <div class="profile-header">
                            <div class="avatar-container">
                                <img src="{% if user.profile_photo %}{{ user.profile_photo.url }}{% else %}{% static 'img/naruto.png' %}{% endif %}" alt="User Avatar" class="profile-avatar" id="profileAvatar">
                                <div class="avatar-overlay">
                                    <i class="fas fa-camera"></i>
                                    <span>Change Photo</span>
                                </div>
                            </div>
                            <input type="file" id="profilePhotoInput" style="display: none;" accept="image/*">
                            <h2>{{ user.get_full_name }}</h2>
                        </div>
                        <div class="profile-body">
                            <div class="user-info">
                                <p><i class="fas fa-envelope"></i> {{user.email}}</p>
                                <p><i class="fas fa-phone"></i> {{user.phone_number|default:"Not provided"}}</p>
                            </div>
                            <div class="user-addresses">
                                <h3>Addresses <button class="btn btn-sm btn-add" id="addAddressBtn"><i class="fas fa-plus"></i> Add Address</button></h3>
                                <ul class="address-list">
                                    {% for address in addresses %}
                                    <li class="address-item">
                                        <span>{{address.address_line1}}, {{address.city}}, {{address.state}}, {{address.postal_code}}</span>
                                        <button class="btn btn-sm btn-edit edit-address-btn" data-address-id="{{ address.id }}"><i class="fas fa-edit"></i> Edit</button>
                                        <button class="btn btn-sm btn-danger delete-address-btn" data-address-id="{{address.id}}">Delete</button>
                                    </li>
                                    {% empty %}
                                    <li class="no-address">No address provided</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                        <div class="profile-footer">
                            <button class="btn btn-primary" id="editProfileBtn"><i class="fas fa-user-edit"></i> Edit Profile</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal for Edit Profile -->
    <div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog" aria-labelledby="editProfileModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form action="#" method="post" id="editProfileForm">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="firstName">First Name</label>
                            <input type="text" class="form-control" id="firstName" name="first_name" value="{{ user.first_name }}">
                        </div>
                        <div class="form-group">
                            <label for="lastName">Last Name</label>
                            <input type="text" class="form-control" id="lastName" name="last_name" value="{{ user.last_name }}">
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}">
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone</label>
                            <input type="tel" class="form-control" id="phone" name="phone_number" value="{{ user.phone_number }}">
                        </div>
                        <div class="form-group">
                            <label for="currentPassword">Current Password</label>
                            <input type="password" class="form-control" id="currentPassword" name="current_password">
                        </div>
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" class="form-control" id="newPassword" name="new_password">
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmPassword" name="confirm_password">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveProfileChanges">Save changes</button>
                </div>
            </div>
        </div>
    </div>
    <!-- modal for add adddress -->
    <div class="modal fade" id="addressModal" tabindex="-1" role="dialog" aria-labelledby="addressModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addressModalLabel">Add/Edit Address</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addressForm">
                        {% csrf_token %}
                        <input type="hidden" id="addressId" name="address_id">
                        <div class="form-group">
                            <label for="addressLine1">Address Line 1</label>
                            <input type="text" class="form-control" id="addressLine1" name="address_line1" required>
                        </div>
                        <div class="form-group">
                            <label for="addressLine2">Address Line 2</label>
                            <input type="text" class="form-control" id="addressLine2" name="address_line2">
                        </div>
                        <div class="form-group">
                            <label for="city">City</label>
                            <input type="text" class="form-control" id="city" name="city" required>
                        </div>
                        <div class="form-group">
                            <label for="state">State</label>
                            <input type="text" class="form-control" id="state" name="state" required>
                        </div>
                        <div class="form-group">
                            <label for="postalCode">Postal Code</label>
                            <input type="text" class="form-control" id="postalCode" name="postal_code" required>
                        </div>
                        <div class="form-group">
                            <label for="country">Country</label>
                            <input type="text" class="form-control" id="country" name="country" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveAddress">Save Address</button>
                </div>
            </div>
        </div>
    </div>
    

	<!-- start footer Area -->
	<footer class="footer-area section_gap">
		<div class="container">
			<div class="row">
				<div class="col-lg">
					<div class="single-footer-widget about-us-widget">
						<h6>About Us</h6>
						<p>
							Welcome to Baka Store, your ultimate destination for anime action figures. We are passionate about bringing your favorite characters to life with high-quality figures. Our mission is to provide anime enthusiasts with a wide variety of collectibles, ensuring that every fan can find something they love. At Baka Store, we are committed to delivering exceptional products and customer service. Join us in celebrating the world of anime!
						</p>
					</div>
				</div>
			</div>
			<div class="footer-bottom d-flex justify-content-center align-items-center flex-wrap">
				<p class="footer-text m-0">
					Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | Baka Store
				</p>
			</div>
			
		</div>
	</footer>
	<!-- End footer Area -->
	<script src="{% static 'js/vendor/jquery-2.2.4.min.js' %}"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
	 crossorigin="anonymous"></script>
	<script src="{% static 'js/vendor/bootstrap.min.js' %}"></script>
	<script src="{% static 'js/jquery.ajaxchimp.min.js' %}"></script>
	<script src="{% static 'js/jquery.nice-select.min.js' %}"></script>
	<script src="{% static 'js/jquery.sticky.js' %}"></script>
	<script src="{% static 'js/nouislider.min.js' %}"></script>
	<script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
	<script src="{% static 'js/owl.carousel.min.js' %}"></script>
	<!--gmaps Js-->
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjCGmQ0Uq4exrzdcL6rvxywDDOvfAu6eE"></script>
	<script src="{% static 'js/gmaps.min.js' %}"></script>
	<script src="{% static 'js/main.js' %}"></script>
    <script>
        $(document).ready(function() {
            // Function to get CSRF token from cookies
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.startsWith(name + '=')) {
                            cookieValue = decodeURIComponent(cookie.slice(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
    
            // Show edit profile modal
            $('#editProfileBtn').click(function() {
                $('#editProfileModal').modal('show');
            });
    
            // Save profile changes
            $('#saveProfileChanges').click(function() {
                const formData = new FormData($('#editProfileForm')[0]);
                $.ajax({
                    url: '/update-profile/',  // Update to match Django URL
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    headers: { 'X-CSRFToken': getCookie('csrftoken') },
                    beforeSend: function() {
                        $('#saveProfileChanges').prop('disabled', true).text('Saving...');
                    },
                    success: function(response) {
                        if (response.success) {
                            alert('Profile updated successfully');
                            location.reload();
                        } else {
                            alert('Failed to update profile: ' + response.error);
                        }
                    },
                    error: function() {
                        alert('An error occurred. Please try again.');
                    },
                    complete: function() {
                        $('#saveProfileChanges').prop('disabled', false).text('Save Changes');
                    }
                });
            });
    
            // Add new address
            $('#addAddressBtn').click(function() {
                $('#addressId').val('');
                $('#addressForm')[0].reset();
                $('#addressModal').modal('show');
            });
    
            // Edit existing address
            $('.edit-address-btn').click(function() {
                const addressId = $(this).data('address-id');
                $.get('/get-address/', { id: addressId }, function(data) {
                    if (data) {
                        $('#addressId').val(data.id);
                        $('#addressLine1').val(data.address_line1);
                        $('#addressLine2').val(data.address_line2);
                        $('#city').val(data.city);
                        $('#state').val(data.state);
                        $('#postalCode').val(data.postal_code);
                        $('#country').val(data.country);
                        $('#addressModal').modal('show');
                    } else {
                        alert('Failed to load address details');
                    }
                });
            });
    
            // Save address
            $('#saveAddress').click(function() {
                // Get form values
                const addressLine1 = $('#addressLine1').val().trim();
                const city = $('#city').val().trim();
                const state = $('#state').val().trim();
                const postalCode = $('#postalCode').val().trim();
                const country = $('#country').val().trim();
            
                // Clear previous error messages
                $('.error-message').remove();
            
                // Validate required fields
                let isValid = true;
            
                if (!addressLine1) {
                    $('#addressLine1').after('<span class="error-message text-danger">Address Line 1 is required.</span>');
                    isValid = false;
                }
                if (!city) {
                    $('#city').after('<span class="error-message text-danger">City is required.</span>');
                    isValid = false;
                }
                if (!state) {
                    $('#state').after('<span class="error-message text-danger">State is required.</span>');
                    isValid = false;
                }
                if (!postalCode) {
                    $('#postalCode').after('<span class="error-message text-danger">Postal Code is required.</span>');
                    isValid = false;
                }
                if (!country) {
                    $('#country').after('<span class="error-message text-danger">Country is required.</span>');
                    isValid = false;
                }
            
                // If form is valid, proceed to AJAX submission
                if (isValid) {
                    const formData = new FormData($('#addressForm')[0]);
                    $.ajax({
                        url: '/save-address/',  // Update to match Django URL
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        headers: { 'X-CSRFToken': getCookie('csrftoken') },
                        beforeSend: function() {
                            $('#saveAddress').prop('disabled', true).text('Saving...');
                        },
                        success: function(response) {
                            if (response.success) {
                                alert('Address saved successfully');
                                location.reload();
                            } else {
                                alert('Failed to save address');
                            }
                        },
                        error: function() {
                            alert('An error occurred. Please try again.');
                        },
                        complete: function() {
                            $('#saveAddress').prop('disabled', false).text('Save Address');
                        }
                    });
                }
            });            
    
            // Delete address
            $('.delete-address-btn').click(function(e) {
                e.preventDefault();
                const addressId = $(this).data('address-id');
                if (confirm('Are you sure you want to delete this address?')) {
                    $.ajax({
                        url: '/delete-address/' + addressId + '/',
                        type: 'POST',
                        headers: { 'X-CSRFToken': getCookie('csrftoken') },
                        success: function(response) {
                            if (response.success) {
                                alert('Address deleted successfully');
                                location.reload();
                            } else {
                                alert('Failed to delete address: ' + response.error);
                            }
                        },
                        error: function() {
                            alert('An error occurred. Please try again.');
                        }
                    });
                }
            });
    
            // Profile photo upload
            $('.avatar-container').click(function() {
                $('#profilePhotoInput').click();
            });
    
            $('#profilePhotoInput').change(function(event) {
                const file = event.target.files[0];
                if (file) {
                    const formData = new FormData();
                    formData.append('profile_photo', file);
    
                    $.ajax({
                        url: '/upload-profile-photo/',  // Update to match Django URL
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        headers: { 'X-CSRFToken': getCookie('csrftoken') },
                        beforeSend: function() {
                            $('.avatar-container').addClass('loading'); // Add a loading class for styling
                        },
                        success: function(data) {
                            if (data.success) {
                                $('#profileAvatar').attr('src', data.photo_url);
                            } else {
                                alert('Failed to upload photo. Please try again.');
                            }
                        },
                        error: function() {
                            alert('An error occurred. Please try again.');
                        },
                        complete: function() {
                            $('.avatar-container').removeClass('loading');
                        }
                    });
                }
            });
        });
    </script>    
</body>

</html>